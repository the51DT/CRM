<!DOCTYPE html>
<html lang="en">
  <div data-include-path="/fragments/head.html"></div>
  <body>
    <div id="root">
      <!-- header include -->
      <header id="header">
        <div data-include-path="/fragments/header.html"></div>
      </header>
      <!-- container -->
      <div id="container">
        <!-- lnb include -->
        <nav id="lnb">
          <div data-include-path="/fragments/lnb.html"></div>
        </nav>
        <!-- contents -->
        <div id="contents">
          <div class="contents__inner">
            <h2>권한 관리</h2>

            <div class="tabs">
              <ul class="nav nav-underline">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/web/userPermsMgmt/userPermsMgmt.html">사용자 권한 관리</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/web/pageRoleMgmt/pageRoleMgmt.html">메뉴별 권한 관리</a>
                </li>
              </ul>
            </div>

            <section class="row">
              <div class="form-box">
                <table class="form-table">
                  <colgroup>
                    <col style="width: 140px" />
                    <col style="width: 30%" />
                    <col style="width: 72px" />
                    <col />
                  </colgroup>
                  <tbody>
                    <tr>
                      <th>이름</th>
                      <td>
                        <div class="input-form w300">
                          <div class="inner">
                            <input type="text" name="userName" placeholder="이름을 입력해 주세요" value="" onkeydown="handleKeyDown(event)" />
                          </div>
                          <div class="error">이름을 입력해 주세요.</div>
                        </div>
                      </td>
                      <th>마당 ID</th>
                      <td>
                        <div class="input-form w300">
                          <div class="inner">
                            <input type="text" name="userId" placeholder="마당ID를 입력해 주세요" value="" onkeydown="handleKeyDown(event)" />
                          </div>
                          <div class="error">마당ID를 입력해 주세요.</div>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <th>직원 구분</th>
                      <td class="employeeType">
                        <select class="uiscroll w300" aria-label="직원 구분 선택">
                          <option data-value="">직원 구분을 선택해 주세요</option>
                          <option data-value="">option1</option>
                        </select>
                      </td>
                      <th>소속</th>
                      <td>
                        <div class="input-form w300">
                          <div class="inner">
                            <input type="text" name="userDeptName" placeholder="소속을 입력해 주세요" value="" onkeydown="handleKeyDown(event)" />
                          </div>
                          <div class="error">소속을 입력해 주세요.</div>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <th>사용자 권한</th>
                      <td colspan="3">
                        <span class="custom-radio">
                          <input id="ALL" name="roleGroupId" type="radio" value="" checked />
                          <label for="ALL" class="button">전체(420)</label>
                        </span>
                        <span class="custom-radio">
                          <input id="Master" name="roleGroupId" type="radio" value="Master" />
                          <label for="Master" class="button">마스터(420)</label>
                        </span>
                        <span class="custom-radio">
                          <input id="AllManage" name="roleGroupId" type="radio" value="AllManage" />
                          <label for="AllManage" class="button">전체 관리자(420)</label>
                        </span>
                        <span class="custom-radio">
                          <input id="FieldManage" name="roleGroupId" type="radio" value="FieldManage" />
                          <label for="FieldManage" class="button">현장 관리자(420)</label>
                        </span>
                        <span class="custom-radio">
                          <input id="User" name="roleGroupId" type="radio" value="User" />
                          <label for="User" class="button">사용자(420)</label>
                        </span>
                        <span class="custom-radio">
                          <input id="NonRole" name="roleGroupId" type="radio" value="NonRole" />
                          <label for="NonRole" class="button">권한없음(420)</label>
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="flex">
                  <button type="button" class="btn btn-ico btn-reset">초기화</button>
                  <button type="button" class="btn btn-ico btn-inquiry">조회</button>
                </div>
              </div>
            </section>

            <!-- 2025-05 신규 수정/추가 -->
            <section class="row">
              <table id="pubTable1">
                <thead>
                  <tr>
                    <th>
                      <span class="custom-checkbox">
                        <input type="checkbox" id="select-all" />
                        <label for="select-all">
                          <i class="icon"></i>
                        </label>
                      </span>
                    </th>
                    <th>번호</th>
                    <th>이름</th>
                    <th>마당 ID</th>
                    <th>직원 구분</th>
                    <th>소속</th>
                    <th>권한</th>
                    <th>등록일</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <span class="custom-checkbox">
                        <input id="userPerms_check" type="checkbox" />
                        <label for="userPerms_check">
                          <i class="icon"></i>
                        </label>
                      </span>
                    </td>
                    <td>1</td>
                    <td>홍길동</td>
                    <td>
                      <button type="button">lguplusmadangid</button>
                    </td>
                    <td>CS 팀장</td>
                    <td>강남 홈서비스 고객만족 실행팀</td>
                    <td>현장 관리자</td>
                    <td>2025-05-01 12:00</td>
                  </tr>
                  <tr>
                    <td>
                      <span class="custom-checkbox">
                        <input id="userPerms_check" type="checkbox" />
                        <label for="userPerms_check">
                          <i class="icon"></i>
                        </label>
                      </span>
                    </td>
                    <td>1</td>
                    <td>홍길동</td>
                    <td>
                      <button type="button">lguplusmadangid</button>
                    </td>
                    <td>CS 팀장</td>
                    <td>강남 홈서비스 고객만족 실행팀</td>
                    <td>현장 관리자</td>
                    <td>2025-05-01 12:00</td>
                  </tr>
                </tbody>
              </table>
            </section>
            <!-- 2025-05 신규 수정/추가 -->

            <!-- 신규 등록 모달 -->
            <div
              class="modal fade"
              id="inputUser"
              tabindex="-1"
              aria-labelledby="inputUserLabel"
              aria-hidden="true"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="btn-closed" id="inputClosed" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body uiscroll">
                    <h1 class="modal-title" id="inputUserLabel">사용자 권한 등록</h1>

                    <section class="row">
                      <table class="form-table">
                        <input type="hidden" name="inputDeptCd" id="inputDeptCd" readonly placeholder="" value="" />
                        <colgroup>
                          <col style="width: 110px" />
                          <col />
                        </colgroup>
                        <tbody>
                          <tr>
                            <th>마당 ID</th>
                            <td>
                              <div class="d-flex gap-08">
                                <div class="col-auto">
                                  <div id="madangid" class="input-form w-auto">
                                    <div class="inner">
                                      <input
                                        type="text"
                                        placeholder="마당 ID를 입력해 주세요."
                                        value=""
                                        id="inputUserId"
                                        name="inputUserId"
                                        onkeydown="handleKeyDown2(event)"
                                      />
                                    </div>
                                    <div class="error" id="errorAlreadyRegistered">이미 등록된 사용자입니다</div>
                                    <div class="error" id="errorNotFound">일치하는 ID를 찾을 수 없습니다.</div>
                                    <div class="success" id="successId">등록 가능한 사용자입니다.</div>
                                  </div>
                                </div>
                                <div class="col-auto">
                                  <button type="button" class="btn btn-dark userSearch">검색</button>
                                </div>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>이름</th>
                            <td>
                              <div class="input-form w-auto">
                                <input type="text" name="inputUserName" id="inputUserName" readonly placeholder="" value="" />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>직원 구분</th>
                            <td id="inputEmployeeType">
                              <select id="inputEmployee" class="uiscroll" aria-label="직원 구분 선택" style="width: 230px">
                                <option data-value="">직원 구분을 선택해 주세요</option>
                                <option th:each="arraysts : ${emploType}" th:value="${arraysts.codeName}">
                                  <th:block th:text="${arraysts.codeName}"></th:block>
                                </option>
                              </select>
                            </td>
                          </tr>
                          <tr>
                            <th>소속</th>
                            <td>
                              <div class="input-form w-auto">
                                <input type="text" name="inputUserDeptName" id="inputUserDeptName" readonly placeholder="" value="" />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>권한 선택</th>
                            <td id="inputRoleGroupId">
                              <select id="inputRole" class="uiscroll" aria-label="권한 선택" style="width: 230px">
                                <option data-value="">권한을 선택해 주세요</option>
                                <option th:each="arraysts : ${roleList}" th:value="${arraysts.roleGroupId}">
                                  <th:block th:text="${arraysts.roleGroupName}"></th:block>
                                </option>
                              </select>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </section>
                  </div>
                  <div class="modal-footer">
                    <div class="d-grid">
                      <button type="button" class="btn btn-dark inputBtn" disabled>확인</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- // 신규 등록 모달 -->
            <!-- 권한 수정 모달 -->
            <div
              class="modal fade"
              id="updateUser"
              tabindex="-1"
              aria-labelledby="updateUserLabel"
              aria-hidden="true"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="btn-closed" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body uiscroll">
                    <h1 class="modal-title" id="updateUserLabel">사용자 권한 보기/수정</h1>

                    <section class="row">
                      <table class="form-table">
                        <colgroup>
                          <col style="width: 110px" />
                          <col />
                        </colgroup>
                        <tbody>
                          <tr>
                            <th>마당 ID</th>
                            <td id="userId"></td>
                          </tr>
                          <tr>
                            <th>이름</th>
                            <td id="userName"></td>
                          </tr>
                          <tr>
                            <th>직원 구분</th>
                            <td id="employeeType">
                              <select class="uiscroll" aria-label="직원 구분 선택" style="width: 230px">
                                <option data-value="">직원 구분을 선택해 주세요</option>
                                <option th:each="arraysts : ${emploType}" th:value="${arraysts.codeName}">
                                  <th:block th:text="${arraysts.codeName}"></th:block>
                                </option>
                              </select>
                            </td>
                          </tr>
                          <tr>
                            <th>소속</th>
                            <td id="userDeptName">홈서비스 프로세스 관리팀</td>
                          </tr>
                          <tr>
                            <th>권한 선택</th>
                            <td id="roleGroupId">
                              <select class="uiscroll" aria-label="권한 선택" style="width: 230px">
                                <option data-value="">권한을 선택해 주세요</option>
                                <option th:each="arraysts : ${roleList}" th:value="${arraysts.roleGroupId}">
                                  <th:block th:text="${arraysts.roleGroupName}"></th:block>
                                </option>
                              </select>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </section>
                  </div>
                  <div class="modal-footer">
                    <div class="d-flex gap-08">
                      <div class="col-auto">
                        <button type="button" class="btn btn-outline-dark NonRole">권한 회수</button>
                      </div>
                      <div class="col">
                        <button type="button" class="btn btn-dark w100p updateBtn">확인</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- // 권한 수정 모달 -->
          </div>
          <style>
            .user-link {
              cursor: pointer;
              text-decoration: underline;
              color: #1f1f1f;
            }
          </style>
          <script></script>
        </div>
        <!-- // contents -->
      </div>
      <!-- // container -->
    </div>
  </body>
  <script src="/assets/js/plugins/jquery-3.7.1.min.js"></script>
  <script src="/assets/js/plugins/bootstrap.bundle.min.js"></script>
  <script src="/assets/js/plugins/moment-with-locales.min.js"></script>
  <script src="/assets/js/plugins/tempusdominus-bootstrap-4.js"></script>
  <script src="/assets/js/plugins/swiper-bundle.min.js"></script>
  <script src="/assets/js/plugins/dataTables.min.js"></script>
  <script src="/assets/js/plugins/jstree.min.js"></script>
  <script src="/assets/js/common.js"></script>
  <script src="/js/common2.js"></script>
  <script src="/js/chart.umd.js"></script>
  <script>
    window.addEventListener("load", function () {
      var allElements = document.getElementsByTagName("*");
      Array.prototype.forEach.call(allElements, function (el) {
        var includePath = el.dataset.includePath;
        if (includePath) {
          var HTTP = new XMLHttpRequest();
          HTTP.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              el.outerHTML = this.responseText;
            }
          };
          HTTP.open("GET", includePath, true);
          HTTP.send();
        }
      });
    });

    // s : 퍼블 화면 테스트 스크립트
    $("#pubTable1").DataTable({
      autoWidth: false,
      searching: false,
      responsive: true,
      ordering: false,
      info: false,
      recordsTotal: false,
      language: {
        lengthMenu: "총 _TOTAL_ 건 _MENU_",
      },
      dom: "<'dt-container'lB>rtp",
      buttons: [
        {
          extend: "",
          text: "신규등록",
          className: "btn btn-ico btn-new-write",
          action: function () {
            console.log("신규등록");
          },
        },
        {
          extend: "",
          text: "선택삭제",
          className: "btn btn-dark",
          attr: {
            id: "deleteSelectedBtn",
            disabled: "true",
          },
          action: function () {
            console.log("선택삭제");
          },
        },
      ],
      initComplete: function () {
        // dt-button 버튼 초기화
        const dtButtons = document.querySelectorAll(".dt-container .dt-buttons .btn");
        dtButtons.forEach((button) => {
          button.classList.remove("dt-button");
        });

        // 셀렉트 로딩
        UI.isSelectCustom();
      },
    });

    function updateDeleteSelectedBtn() {
      const checkboxes = document.querySelectorAll('#pubTable1 tbody input[type="checkbox"]');
      const anyChecked = Array.from(checkboxes).some((cb) => cb.checked);
      const deleteBtn = document.getElementById("deleteSelectedBtn");
      if (deleteBtn) {
        deleteBtn.disabled = !anyChecked || checkboxes.length === 0;
      }
      // select-all 체크박스 상태 동기화
      const selectAll = document.getElementById("select-all");
      if (selectAll) {
        if (!anyChecked) {
          selectAll.checked = false;
        }
      }
    }

    document.getElementById("select-all").addEventListener("change", function () {
      const checked = this.checked;
      document.querySelectorAll('#pubTable1 tbody input[type="checkbox"]').forEach(function (check) {
        check.checked = checked;
      });
      updateDeleteSelectedBtn();
    });
    document.querySelectorAll('#pubTable1 tbody input[type="checkbox"]').forEach(function (checkbox) {
      checkbox.addEventListener("change", updateDeleteSelectedBtn);
    });

    const lnbActiveTest = () => {
      const lnbActive = lnb.querySelector(".depth1-link.manager");
      if (lnbActive) {
        const depth2 = lnbActive.nextElementSibling;
        if (depth2 && depth2.classList.contains("depth2")) {
          depth2.style.display = "block";
          const secondLi = depth2.querySelectorAll("li > a")[0];
          if (secondLi) {
            secondLi.classList.add("active");
          }
        }
      }
      if (lnbActive) {
        lnbActive.classList.add("active");
      }
    };
    setTimeout(() => {
      lnbActiveTest();
    }, 500);
    // e : 퍼블 화면 테스트 스크립트
  </script>
</html>

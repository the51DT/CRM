<!DOCTYPE html>
<html lang="en">
  <div data-include-path="/fragments/head.html"></div>
  <body>
    <div id="root">
      <!-- header include -->
      <header id="header">
        <div data-include-path="/fragments/header.html"></div>
      </header>
      <!-- container -->
      <div id="container">
        <!-- lnb include -->
        <nav id="lnb">
          <div data-include-path="/fragments/lnb.html"></div>
        </nav>
        <!-- contents -->
        <div id="contents">
          <div class="contents__inner">
            <h2>상담 관리</h2>

            <div class="tabs">
              <ul class="nav nav-underline">
                <li class="nav-item">
                  <a class="nav-link" href="/web/codeMgmt/codeMgmt.html">고객 특이 사항 관리</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/web/vocLabMgmt/vocLabMgmt.html">VOC LAB 제외 처리</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/web/specialCustMgmt/specialCustMgmt.html">특별 고객 관리</a>
                </li>
              </ul>
            </div>

            <section class="row">
              <div class="form-box">
                <table class="form-table">
                  <colgroup>
                    <col style="width: 140px" />
                    <col style="width: 30%" />
                    <col style="width: 72px" />
                    <col />
                  </colgroup>
                  <tbody>
                    <tr>
                      <th>가입 번호</th>
                      <td>
                        <div class="input-form w300">
                          <div class="inner">
                            <input type="text" name="subscriberNo" placeholder="가입 번호를 입력해 주세요" value="" onkeydown="" />
                          </div>
                          <div class="error">가입 번호를 입력해 주세요.</div>
                        </div>
                      </td>
                      <th>조직 코드</th>
                      <td>
                        <div class="input-form w300">
                          <div class="inner">
                            <input type="text" name="orgCode" placeholder="조직 코드를 입력해 주세요" value="" onkeydown="" />
                          </div>
                          <div class="error">조직 코드를 입력해 주세요.</div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="flex">
                  <button type="button" class="btn btn-ico btn-reset">초기화</button>
                  <button type="button" class="btn btn-ico btn-inquiry">조회</button>
                </div>
              </div>
            </section>

            <section class="row">
              <table id="pubTable1">
                <thead>
                  <tr>
                    <th>
                      <span class="custom-checkbox">
                        <input type="checkbox" id="select-all" />
                        <label for="select-all">
                          <i class="icon"></i>
                        </label>
                      </span>
                    </th>
                    <th>번호</th>
                    <th>가입 번호</th>
                    <th>서비스</th>
                    <th>조직 코드</th>
                    <th>조직명</th>
                    <th>등록 사유</th>
                    <th>비고</th>
                    <th>조회</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <span class="custom-checkbox">
                        <input id="userPerms_check" type="checkbox" />
                        <label for="userPerms_check">
                          <i class="icon"></i>
                        </label>
                      </span>
                    </td>
                    <td>1</td>
                    <td>1234567890123</td>
                    <td>홍길동</td>
                    <td>HS001</td>
                    <td>VIP고객지원팀</td>
                    <td>난개통 지역 고객으로 지원센터 Care...</td>
                    <td>난개통 지역으로 특수 배선 점검...</td>
                    <td>
                      <!-- 작은 버튼 임시 -->
                      <button type="button" class="btn btn-outline-secondary btn-small" data-bs-toggle="modal" data-bs-target="#specialCustView">조회</button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <span class="custom-checkbox">
                        <input id="userPerms_check" type="checkbox" />
                        <label for="userPerms_check">
                          <i class="icon"></i>
                        </label>
                      </span>
                    </td>
                    <td>1</td>
                    <td>1234567890123</td>
                    <td>홍길동</td>
                    <td>HS001</td>
                    <td>VIP고객지원팀</td>
                    <td>난개통 지역 고객으로 지원센터 Care...</td>
                    <td>난개통 지역으로 특수 배선 점검...</td>
                    <td>
                      <!-- 작은 버튼 임시 -->
                      <button type="button" class="btn btn-outline-secondary btn-small" data-bs-toggle="modal" data-bs-target="#specialCustView">조회</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </section>

            <!-- 특별 고객 등록 모달 -->
            <div
              id="specialCustInsert"
              class="modal fade"
              tabindex="-1"
              aria-labelledby="specialCustInsertLabel"
              aria-hidden="true"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
            >
              <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="btn-closed" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body uiscroll">
                    <h1 class="modal-title" id="specialCustInsertLabel">특별 고객 등록</h1>
                    <section class="row">
                      <table class="form-table">
                        <colgroup>
                          <col style="width: 110px" />
                          <col />
                        </colgroup>
                        <tbody>
                          <tr>
                            <th>가입 번호</th>
                            <td>
                              <div class="input-form w220">
                                <input type="text" id="entrNoInput" name="entrNo" placeholder="가입 번호를 입력해 주세요" value="" maxlength="12" />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>서비스</th>
                            <td>
                              <select class="w220 uiscroll" aria-label="서비스 선택">
                                <option value="">서비스를 선택해 주세요</option>
                                <option value="">인터넷</option>
                                <option value="">TV</option>
                              </select>
                            </td>
                          </tr>
                          <tr>
                            <th>조직 코드</th>
                            <td>
                              <div class="d-flex gap-08">
                                <div class="col-auto">
                                  <!-- error시 error 클래스 추가, 등록 가능시 success 클래스 추가 -->
                                  <div id="checkCodeDuplicateMsg" class="input-form w220">
                                    <div class="inner">
                                      <input id="orgCodeInput" type="text" placeholder="조직 코드를 입력해 주세요" value="" />
                                    </div>
                                    <div class="error">해당 조직이 존재하지 않습니다</div>
                                    <div class="success">등록 가능한 조직 코드입니다</div>
                                  </div>
                                </div>
                                <div class="col-auto">
                                  <button id="checkOrgCodeBtn" type="button" class="btn btn-dark" onclick="alertPubTest();">조회</button>
                                </div>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>조직명</th>
                            <td>
                              <div class="input-form w220">
                                <input type="text" id="orgNameInput" name="orgName" placeholder="" value="VIP고객지원팀" disabled />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>등록 사유</th>
                            <td>
                              <div class="input-form w220">
                                <input type="text" id="regReasonInput" name="regReason" placeholder="등록 사유를 입력해 주세요" value="" />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>비고</th>
                            <td>
                              <div class="input-form w220">
                                <input type="text" id="remarkInput" name="remark" placeholder="비고를 입력해 주세요" value="" />
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </section>
                  </div>
                  <div class="modal-footer">
                    <div class="d-grid">
                      <button type="button" class="btn btn-dark" id="insertBtn" onclick="insertBtn()">등록</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- // 특별 고객 등록 모달 -->

            <!-- 특별 고객 수정 모달 -->
            <div
              id="specialCustUpdate"
              class="modal fade"
              tabindex="-1"
              aria-labelledby="specialCustUpdateLabel"
              aria-hidden="true"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
            >
              <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="btn-closed" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body uiscroll">
                    <h1 class="modal-title" id="specialCustUpdateLabel">특별 고객 수정</h1>
                    <section class="row">
                      <table class="form-table">
                        <colgroup>
                          <col style="width: 110px" />
                          <col />
                        </colgroup>
                        <tbody>
                          <tr>
                            <th>가입 번호</th>
                            <td>
                              <div class="input-form w220">
                                <input type="text" id="entrNoInput" name="entrNo" placeholder="가입 번호를 입력해 주세요" value="123456789112" maxlength="12" />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>서비스</th>
                            <td>
                              <select class="w220 uiscroll" aria-label="서비스 선택">
                                <option value="">서비스를 선택해 주세요</option>
                                <option value="" selected>인터넷</option>
                                <option value="">TV</option>
                              </select>
                            </td>
                          </tr>
                          <tr>
                            <th>조직 코드</th>
                            <td>
                              <div class="d-flex gap-08">
                                <div class="col-auto">
                                  <!-- error시 error 클래스 추가, 등록 가능시 success 클래스 추가 -->
                                  <div id="checkCodeDuplicateMsg" class="input-form w220">
                                    <div class="inner">
                                      <input id="orgCodeInput" type="text" placeholder="조직 코드를 입력해 주세요" value="" />
                                    </div>
                                    <div class="error">해당 조직이 존재하지 않습니다</div>
                                    <div class="success">등록 가능한 조직 코드입니다</div>
                                  </div>
                                </div>
                                <div class="col-auto">
                                  <button id="checkOrgCodeBtn" type="button" class="btn btn-dark" onclick="alertPubTest();">조회</button>
                                </div>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>조직명</th>
                            <td>
                              <div class="input-form w220">
                                <input type="text" id="orgNameInput" name="orgName" placeholder="" value="VIP고객지원팀" disabled />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>등록 사유</th>
                            <td>
                              <div class="input-form w220">
                                <input
                                  type="text"
                                  id="regReasonInput"
                                  name="regReason"
                                  placeholder="등록 사유를 입력해 주세요"
                                  value="강성 민원 고객으로 별도 Care"
                                />
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <th>비고</th>
                            <td>
                              <div class="input-form w220">
                                <input type="text" id="remarkInput" name="remark" placeholder="비고를 입력해 주세요" value="강성민원 3회 이상 발생고객" />
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </section>
                  </div>
                  <div class="modal-footer">
                    <div class="d-grid">
                      <button type="button" class="btn btn-dark" id="insertBtn" onclick="insertBtn()">등록</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- // 특별 고객 수정 모달 -->

            <!-- 특별 고객 조회 모달 -->
            <div
              id="specialCustView"
              class="modal fade"
              tabindex="-1"
              aria-labelledby="specialCustViewLabel"
              aria-hidden="true"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
            >
              <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="btn-closed" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body uiscroll">
                    <h1 class="modal-title" id="specialCustViewLabel">특별 고객 조회</h1>
                    <section class="row">
                      <table class="form-table">
                        <colgroup>
                          <col style="width: 110px" />
                          <col />
                        </colgroup>
                        <tbody>
                          <tr>
                            <th>가입 번호</th>
                            <td>123456789112</td>
                          </tr>
                          <tr>
                            <th>서비스</th>
                            <td>TV</td>
                          </tr>
                          <tr>
                            <th>조직 코드</th>
                            <td>TS25145</td>
                          </tr>
                          <tr>
                            <th>조직명</th>
                            <td>VIP고객지원팀</td>
                          </tr>
                          <tr>
                            <th>등록 사유</th>
                            <td>강성 민원 고객으로 별도 Care</td>
                          </tr>
                          <tr>
                            <th>비고</th>
                            <td>강성민원 3회 이상 발생고객</td>
                          </tr>
                        </tbody>
                      </table>
                    </section>
                  </div>
                  <div class="modal-footer">
                    <div class="d-flex gap-08">
                      <div class="col-auto">
                        <button type="button" class="btn btn-outline-dark NonRole" data-bs-toggle="modal" data-bs-target="#specialCustUpdate">수정</button>
                      </div>
                      <div class="col">
                        <button type="button" class="btn btn-dark w100p updateBtn">확인</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- // 특별 고객 조회 모달 -->
          </div>
        </div>
        <!-- // contents -->
      </div>
      <!-- // container -->
    </div>
  </body>
  <script src="/assets/js/plugins/jquery-3.7.1.min.js"></script>
  <script src="/assets/js/plugins/bootstrap.bundle.min.js"></script>
  <script src="/assets/js/plugins/moment-with-locales.min.js"></script>
  <script src="/assets/js/plugins/tempusdominus-bootstrap-4.js"></script>
  <script src="/assets/js/plugins/swiper-bundle.min.js"></script>
  <script src="/assets/js/plugins/dataTables.min.js"></script>
  <script src="/assets/js/plugins/jstree.min.js"></script>
  <script src="/assets/js/common.js"></script>
  <script src="/js/common2.js"></script>
  <script src="/js/chart.umd.js"></script>
  <script>
    window.addEventListener("load", function () {
      var allElements = document.getElementsByTagName("*");
      Array.prototype.forEach.call(allElements, function (el) {
        var includePath = el.dataset.includePath;
        if (includePath) {
          var HTTP = new XMLHttpRequest();
          HTTP.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
              el.outerHTML = this.responseText;
            }
          };
          HTTP.open("GET", includePath, true);
          HTTP.send();
        }
      });
    });

    // 퍼블테스트
    $("#pubTable1").DataTable({
      autoWidth: false,
      searching: false,
      responsive: true,
      ordering: false,
      info: false,
      recordsTotal: false,
      language: {
        lengthMenu: "총 _TOTAL_ 건 _MENU_",
      },
      dom: "<'dt-container'lB>rtp",
      buttons: [
        {
          extend: "",
          text: "다운로드",
          className: "btn btn-ico btn-download",
          action: function () {
            console.log("다운로드");
          },
        },
        {
          extend: "",
          text: "신규등록",
          className: "btn btn-ico btn-new-write",
          attr: {
            id: "addUserBtn",
            "data-bs-toggle": "modal",
            "data-bs-target": "#specialCustInsert",
          },
          action: function () {
            console.log("신규등록");
          },
        },
        {
          extend: "",
          text: "선택삭제",
          className: "btn btn-dark",
          attr: {
            id: "deleteSelectedBtn",
            disabled: "true",
          },
          action: function () {
            console.log("선택삭제");
          },
        },
      ],
      initComplete: function () {
        // dt-button 버튼 초기화
        const dtButtons = document.querySelectorAll(".dt-container .dt-buttons .btn");
        dtButtons.forEach((button) => {
          button.classList.remove("dt-button");
        });

        // 셀렉트 로딩
        UI.isSelectCustom();
      },
    });

    window.alertPubTest = () => {
      const orgCode = document.getElementById("orgCodeInput").value.trim();
      const checkCodeMsg = document.getElementById("orgCodeInput")?.closest("#checkCodeDuplicateMsg");
      const errorDiv = checkCodeMsg.querySelector(".error");
      const successDiv = checkCodeMsg.querySelector(".success");

      if (!orgCode) {
        showAlert({
          image: "<img src='/assets/images/common/icon_info.svg' alt=''>",
          message: "조직 코드를 입력해 주세요",
          oneButton: true,
        });
      } else {
        if (/^\d+$/.test(orgCode)) {
          errorDiv.style.display = "none";
          successDiv.style.display = "block";
        } else {
          errorDiv.style.display = "block";
          successDiv.style.display = "none";
        }
      }
    };
    window.insertBtn = () => {
      const entrNo = document.getElementById("entrNoInput").value.trim();
      const orgCode = document.getElementById("orgCodeInput").value.trim();
      const regReason = document.getElementById("regReasonInput").value.trim();

      if (!entrNo) {
        showAlert({
          image: "<img src='/assets/images/common/icon_info.svg' alt=''>",
          message: "가입 번호를 입력해 주세요.",
          oneButton: true,
        });
        return;
      }
      if (!orgCode) {
        showAlert({
          image: "<img src='/assets/images/common/icon_info.svg' alt=''>",
          message: "조직 코드를 입력해 주세요.",
          oneButton: true,
        });
        return;
      }
      if (!regReason) {
        showAlert({
          image: "<img src='/assets/images/common/icon_info.svg' alt=''>",
          message: "등록 사유를 입력해 주세요.",
          oneButton: true,
        });
        return;
      }
      showAlert({
        image: "<img src='/assets/images/common/icon_info.svg' alt=''>",
        message: "등록되었습니다.",
        oneButton: true,
      });
    };

    function updateDeleteSelectedBtn() {
      const checkboxes = document.querySelectorAll('#pubTable1 tbody input[type="checkbox"]');
      const anyChecked = Array.from(checkboxes).some((cb) => cb.checked);
      const deleteBtn = document.getElementById("deleteSelectedBtn");
      if (deleteBtn) {
        deleteBtn.disabled = !anyChecked || checkboxes.length === 0;
      }
      // select-all 체크박스 상태 동기화
      const selectAll = document.getElementById("select-all");
      if (selectAll) {
        if (!anyChecked) {
          selectAll.checked = false;
        }
      }
    }
    document.getElementById("select-all").addEventListener("change", function () {
      const checked = this.checked;
      document.querySelectorAll('#pubTable1 tbody input[type="checkbox"]').forEach(function (check) {
        check.checked = checked;
      });
      updateDeleteSelectedBtn();
    });
    document.querySelectorAll('#pubTable1 tbody input[type="checkbox"]').forEach(function (checkbox) {
      checkbox.addEventListener("change", updateDeleteSelectedBtn);
    });
  </script>
</html>
